# Music Symbol Detector

A Python script that uses Audiveris to extract musical symbols from sheet music images and draws bounding boxes around sharps, flats, naturals, and noteheads.

## Features

- Processes PNG and JPG images of sheet music
- Detects and highlights:
  - Sharps (Red boxes)
  - Flats (Green boxes)
  - Naturals (Blue boxes)
  - Noteheads (Magenta boxes)
- Outputs annotated image with bounding boxes

## Prerequisites

### 1. Install Audiveris

Download and install Audiveris from the official repository:
https://github.com/Audiveris/audiveris/releases

**For macOS:**
```bash
# Download the latest .dmg file and install
# Or use Homebrew if available
brew install audiveris
```

**For Linux:**
```bash
# Download the .deb or .rpm package
# Or build from source
```

**For Windows:**
```bash
# Download the Windows installer
```

### 2. Install Python Dependencies

```bash
pip install -r requirements.txt
```

Or install manually:
```bash
pip install Pillow
```

## Usage

### Basic Usage

Process a sheet music image:
```bash
python music_symbol_detector.py path/to/your/sheet_music.png
```

### Specify Output Location

```bash
python music_symbol_detector.py input.jpg -o output_with_boxes.jpg
```

### Specify Audiveris Path

If Audiveris is not in your PATH or installed in a non-standard location:
```bash
python music_symbol_detector.py input.png -a /path/to/audiveris
```

Or for JAR file:
```bash
python music_symbol_detector.py input.png -a /path/to/Audiveris.jar
```

### Complete Example

```bash
# Process a PNG file
python music_symbol_detector.py my_sheet_music.png

# Output will be saved as: my_sheet_music_detected.png
```

## How It Works

1. **Upload**: You provide a PNG or JPG image of sheet music
2. **Process**: The script runs Audiveris to perform OMR (Optical Music Recognition)
3. **Extract**: Symbol positions and types are extracted from Audiveris output
4. **Visualize**: Bounding boxes are drawn on the original image with color coding:
   - Red: Sharps (#)
   - Green: Flats (b)
   - Blue: Naturals (n)
   - Magenta: Noteheads (o)
5. **Output**: Annotated image is saved with `_detected` suffix

## Troubleshooting

### Audiveris Not Found
If you see "Audiveris not found" error:
1. Make sure Audiveris is installed
2. Add Audiveris to your PATH, or
3. Use the `-a` flag to specify the path

### No Symbols Detected
If no symbols are detected:
1. Ensure the input image is clear and high-resolution
2. Check that the image contains actual sheet music notation
3. Verify Audiveris can process the image format

### Missing Coordinates
If the script can't find pixel coordinates:
1. Check the `audiveris_output` folder for generated files
2. The script will look for `.omr` files containing positional data
3. Some Audiveris versions may output different formats

## File Structure

After running, you'll see:
```
Sheet Scan Audiveris Test/
├── music_symbol_detector.py    # Main script
├── requirements.txt             # Python dependencies
├── README.md                    # This file
├── audiveris_output/            # Generated by Audiveris
│   └── [image_name]/
│       ├── [image_name].mxl     # MusicXML output
│       └── [image_name].omr     # OMR data with coordinates
└── [image_name]_detected.png    # Output with bounding boxes
```

## Command Line Options

```
usage: music_symbol_detector.py [-h] [-o OUTPUT] [-a AUDIVERIS] image

Detect and visualize music symbols in sheet music images

positional arguments:
  image                 Path to input image (PNG or JPG)

optional arguments:
  -h, --help            show this help message and exit
  -o OUTPUT, --output OUTPUT
                        Path to output image (optional)
  -a AUDIVERIS, --audiveris AUDIVERIS
                        Path to Audiveris executable or JAR file
```

## Notes

- Processing time depends on image size and complexity (typically 30s - 2min)
- First run may be slower as Audiveris initializes
- High-resolution images (300 DPI or higher) work best
- The script creates an `audiveris_output` folder for intermediate files

## License

This script is provided as-is for educational and research purposes.
Audiveris is licensed under AGPL v3.
